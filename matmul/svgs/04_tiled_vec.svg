<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1500 2100" font-family="'Courier New', monospace">
  <style>
    .title { font-size: 22px; font-weight: bold; fill: #222; }
    .section-title { font-size: 17px; font-weight: bold; fill: #333; }
    .subtitle { font-size: 13px; font-weight: bold; fill: #555; }
    .label { font-size: 11px; fill: #333; }
    .small { font-size: 10px; fill: #555; }
    .tiny { font-size: 9px; fill: #666; }
    .code { font-size: 10px; fill: #333; font-family: monospace; }
    .bold { font-weight: bold; }
    .a-fill { fill: #4A90D9; }
    .a-light { fill: #CADFF5; }
    .b-fill { fill: #27AE60; }
    .b-light { fill: #B8E6CC; }
    .c-fill { fill: #E67E22; }
    .c-light { fill: #FDEBD0; }
    .warp-fill { fill: #F1C40F; opacity: 0.6; }
    .coalesced { fill: #8E44AD; }
    .coalesced-light { fill: #D7BDE2; }
    .strided { fill: #C0392B; }
    .reg-fill { fill: #ECF0F1; }
    .outline { fill: none; stroke: #333; stroke-width: 1; }
    .outline-bold { fill: none; stroke: #333; stroke-width: 2; }
    .arrow { fill: none; stroke: #555; stroke-width: 1.5; marker-end: url(#arrowhead); }
    .arrow-bold { fill: none; stroke: #333; stroke-width: 2; marker-end: url(#arrowhead); }
    .dashed { stroke-dasharray: 4,3; }
    .thread-grid { fill: #F9F9F9; stroke: #CCC; stroke-width: 0.5; }
    .broadcast { fill: #2ECC71; opacity: 0.3; }
    .bank-conflict { fill: #E74C3C; opacity: 0.3; }
    .dim-label { font-size: 11px; fill: #888; font-style: italic; }
  </style>
  <defs>
    <marker id="arrowhead" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#555"/>
    </marker>
    <marker id="arrowhead-red" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#C0392B"/>
    </marker>
    <marker id="arrowhead-green" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#27AE60"/>
    </marker>
    <linearGradient id="fma-grad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#F39C12;stop-opacity:0.8"/>
      <stop offset="100%" style="stop-color:#E74C3C;stop-opacity:0.8"/>
    </linearGradient>
  </defs>

  <!-- Background -->
  <rect width="1500" height="2100" fill="#FAFAFA" rx="8"/>

  <!-- ============================================================ -->
  <!-- SECTION 1: Block Tile Overview & Thread Mapping               -->
  <!-- ============================================================ -->
  <text x="750" y="35" text-anchor="middle" class="title">Vectorized Register-Tiled GEMM: Memory Access Patterns</text>
  <text x="750" y="55" text-anchor="middle" class="small">BLK_M=128, BLK_N=128, BLK_K=8, TM=8, TN=8, 256 threads (16x16 grid), PAD=4</text>

  <!-- Section 1 Header -->
  <line x1="40" y1="70" x2="1460" y2="70" stroke="#DDD" stroke-width="1"/>
  <text x="50" y="95" class="section-title">1. Block Tile Decomposition &amp; Thread-to-Output Mapping (same as tiled_reg)</text>

  <!-- A tile (128 x 8) -->
  <g transform="translate(80, 120)">
    <text x="60" y="-5" text-anchor="middle" class="subtitle">As [shared]</text>
    <rect width="48" height="240" class="a-light" stroke="#4A90D9" stroke-width="2" rx="2"/>
    <text x="-10" y="8" text-anchor="end" class="tiny">0</text>
    <text x="-10" y="128" text-anchor="end" class="tiny">64</text>
    <text x="-10" y="238" text-anchor="end" class="tiny">127</text>
    <text x="24" y="260" text-anchor="middle" class="dim-label">8 cols</text>
    <text x="-25" y="120" text-anchor="middle" class="dim-label" transform="rotate(-90,-25,120)">128 rows</text>
    <line x1="0" y1="30" x2="48" y2="30" stroke="#4A90D9" stroke-width="0.5" opacity="0.4"/>
    <line x1="0" y1="60" x2="48" y2="60" stroke="#4A90D9" stroke-width="0.5" opacity="0.4"/>
    <line x1="0" y1="120" x2="48" y2="120" stroke="#4A90D9" stroke-width="0.5" opacity="0.4"/>
    <line x1="0" y1="180" x2="48" y2="180" stroke="#4A90D9" stroke-width="0.5" opacity="0.4"/>
    <rect width="48" height="30" class="warp-fill" rx="1"/>
  </g>

  <!-- Multiply sign -->
  <text x="195" y="255" text-anchor="middle" font-size="28" fill="#333">x</text>

  <!-- B tile (8 x 128) -->
  <g transform="translate(220, 195)">
    <text x="120" y="-5" text-anchor="middle" class="subtitle">Bs [shared]</text>
    <rect width="240" height="48" class="b-light" stroke="#27AE60" stroke-width="2" rx="2"/>
    <text x="2" y="65" text-anchor="start" class="tiny">0</text>
    <text x="118" y="65" text-anchor="middle" class="tiny">64</text>
    <text x="232" y="65" text-anchor="end" class="tiny">127</text>
    <text x="120" y="78" text-anchor="middle" class="dim-label">128 cols</text>
    <text x="-20" y="24" text-anchor="middle" class="dim-label" transform="rotate(-90,-20,24)">8 rows</text>
    <line x1="60" y1="0" x2="60" y2="48" stroke="#27AE60" stroke-width="0.5" opacity="0.4"/>
    <line x1="120" y1="0" x2="120" y2="48" stroke="#27AE60" stroke-width="0.5" opacity="0.4"/>
    <line x1="180" y1="0" x2="180" y2="48" stroke="#27AE60" stroke-width="0.5" opacity="0.4"/>
  </g>

  <!-- Equals sign -->
  <text x="505" y="235" text-anchor="middle" font-size="28" fill="#333">=</text>

  <!-- C tile (128 x 128) with thread grid -->
  <g transform="translate(540, 120)">
    <text x="120" y="-5" text-anchor="middle" class="subtitle">C tile [128x128 output]</text>
    <rect width="240" height="240" class="c-light" stroke="#E67E22" stroke-width="2" rx="2"/>
    <g>
      <line x1="15" y1="0" x2="15" y2="240" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="30" y1="0" x2="30" y2="240" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="45" y1="0" x2="45" y2="240" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="60" y1="0" x2="60" y2="240" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="75" y1="0" x2="75" y2="240" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="90" y1="0" x2="90" y2="240" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="105" y1="0" x2="105" y2="240" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="120" y1="0" x2="120" y2="240" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="135" y1="0" x2="135" y2="240" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="150" y1="0" x2="150" y2="240" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="165" y1="0" x2="165" y2="240" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="180" y1="0" x2="180" y2="240" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="195" y1="0" x2="195" y2="240" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="210" y1="0" x2="210" y2="240" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="225" y1="0" x2="225" y2="240" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="0" y1="15" x2="240" y2="15" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="0" y1="30" x2="240" y2="30" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="0" y1="45" x2="240" y2="45" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="0" y1="60" x2="240" y2="60" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="0" y1="75" x2="240" y2="75" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="0" y1="90" x2="240" y2="90" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="0" y1="105" x2="240" y2="105" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="0" y1="120" x2="240" y2="120" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="0" y1="135" x2="240" y2="135" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="0" y1="150" x2="240" y2="150" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="0" y1="165" x2="240" y2="165" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="0" y1="180" x2="240" y2="180" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="0" y1="195" x2="240" y2="195" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="0" y1="210" x2="240" y2="210" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="0" y1="225" x2="240" y2="225" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
    </g>
    <rect width="240" height="30" fill="#F1C40F" opacity="0.45" rx="1"/>
    <rect width="15" height="15" fill="#E74C3C" opacity="0.5" rx="1"/>
    <text x="120" y="256" text-anchor="middle" class="small">16x16 thread grid, each cell = one thread's 8x8 output</text>
    <text x="7" y="10" class="tiny" fill="#C0392B" font-weight="bold">T0</text>
  </g>

  <!-- Legend -->
  <g transform="translate(810, 140)">
    <rect width="12" height="12" fill="#F1C40F" opacity="0.45" stroke="#333" stroke-width="0.5"/>
    <text x="18" y="11" class="small">Warp 0 (threads 0-31): rows 0-15 of C</text>
    <rect y="18" width="12" height="12" fill="#E74C3C" opacity="0.5" stroke="#333" stroke-width="0.5"/>
    <text x="18" y="29" class="small">Thread 0: C[0:8, 0:8] (8x8 sub-tile)</text>
  </g>

  <!-- Thread layout -->
  <g transform="translate(810, 190)">
    <text x="0" y="0" class="subtitle">Thread Layout (same as tiled_reg):</text>
    <text x="0" y="18" class="code">thread_row = (tid / 16) * 8</text>
    <text x="0" y="32" class="code">thread_col = (tid % 16) * 8</text>
    <text x="0" y="52" class="code">Warp 0: tid 0-31</text>
    <text x="0" y="66" class="code">  T0-T15:  row=0,  col=0,8,...,120</text>
    <text x="0" y="80" class="code">  T16-T31: row=8,  col=0,8,...,120</text>
  </g>

  <!-- ============================================================ -->
  <!-- SECTION 2: Vectorized Global->Shared Loads (KEY DIFFERENCE)  -->
  <!-- ============================================================ -->
  <line x1="40" y1="410" x2="1460" y2="410" stroke="#DDD" stroke-width="1"/>
  <text x="50" y="440" class="section-title">2. Vectorized Global Memory --> Shared Memory: float4 (128-bit) Loads</text>
  <text x="50" y="458" class="small" fill="#C0392B">KEY DIFFERENCE: float4 loads = 16 bytes per thread (vs 4 bytes scalar in tiled_reg) = 4x fewer memory transactions</text>

  <!-- LEFT: A tile vectorized loading -->
  <g transform="translate(60, 480)">
    <text x="200" y="0" text-anchor="middle" class="subtitle" fill="#4A90D9">Loading A Tile: float4 along K dimension</text>
    <text x="200" y="18" text-anchor="middle" class="small">128x8=1024 floats = 256 float4s, 1 float4 per thread</text>
    <text x="200" y="32" text-anchor="middle" class="small">a_row = vec_idx / 2, a_vec_col = vec_idx % 2</text>

    <!-- A tile grid: show rows, 2 float4s per row for warp 0 -->
    <g transform="translate(30, 50)">
      <!-- Column headers -->
      <text x="60" y="-5" text-anchor="middle" class="tiny">k=0:3 (float4)</text>
      <text x="188" y="-5" text-anchor="middle" class="tiny">k=4:7 (float4)</text>

      <!-- Row 0: T0 and T1 -->
      <rect x="0" y="0" width="128" height="28" fill="#3498DB" opacity="0.7" stroke="#2C3E50" stroke-width="1" rx="2"/>
      <text x="64" y="18" text-anchor="middle" class="tiny" fill="white" font-weight="bold">T0: float4 (k=0:3)</text>
      <rect x="128" y="0" width="128" height="28" fill="#3498DB" opacity="0.5" stroke="#2C3E50" stroke-width="1" rx="2"/>
      <text x="192" y="18" text-anchor="middle" class="tiny" fill="white" font-weight="bold">T1: float4 (k=4:7)</text>

      <!-- Row 1: T2 and T3 -->
      <rect x="0" y="28" width="128" height="28" fill="#27AE60" opacity="0.7" stroke="#2C3E50" stroke-width="1" rx="2"/>
      <text x="64" y="46" text-anchor="middle" class="tiny" fill="white" font-weight="bold">T2: float4 (k=0:3)</text>
      <rect x="128" y="28" width="128" height="28" fill="#27AE60" opacity="0.5" stroke="#2C3E50" stroke-width="1" rx="2"/>
      <text x="192" y="46" text-anchor="middle" class="tiny" fill="white" font-weight="bold">T3: float4 (k=4:7)</text>

      <!-- Row 2: T4 and T5 -->
      <rect x="0" y="56" width="128" height="28" fill="#E67E22" opacity="0.7" stroke="#2C3E50" stroke-width="1" rx="2"/>
      <text x="64" y="74" text-anchor="middle" class="tiny" fill="white" font-weight="bold">T4: float4 (k=0:3)</text>
      <rect x="128" y="56" width="128" height="28" fill="#E67E22" opacity="0.5" stroke="#2C3E50" stroke-width="1" rx="2"/>
      <text x="192" y="74" text-anchor="middle" class="tiny" fill="white" font-weight="bold">T5: float4 (k=4:7)</text>

      <!-- ... more rows -->
      <rect x="0" y="84" width="256" height="22" fill="#ECF0F1" stroke="#2C3E50" stroke-width="0.5" rx="2"/>
      <text x="128" y="99" text-anchor="middle" class="tiny" fill="#666">... (T6-T29: rows 3-14, 2 float4s each)</text>

      <!-- Row 15: T30 and T31 -->
      <rect x="0" y="106" width="128" height="28" fill="#8E44AD" opacity="0.7" stroke="#2C3E50" stroke-width="1" rx="2"/>
      <text x="64" y="124" text-anchor="middle" class="tiny" fill="white" font-weight="bold">T30: float4 (k=0:3)</text>
      <rect x="128" y="106" width="128" height="28" fill="#8E44AD" opacity="0.5" stroke="#2C3E50" stroke-width="1" rx="2"/>
      <text x="192" y="124" text-anchor="middle" class="tiny" fill="white" font-weight="bold">T31: float4 (k=4:7)</text>

      <!-- Row labels -->
      <text x="-8" y="18" text-anchor="end" class="small">row 0</text>
      <text x="-8" y="46" text-anchor="end" class="small">row 1</text>
      <text x="-8" y="74" text-anchor="end" class="small">row 2</text>
      <text x="-8" y="124" text-anchor="end" class="small">row 15</text>
    </g>

    <!-- Coalescing analysis for A -->
    <g transform="translate(30, 210)">
      <text x="0" y="0" class="subtitle">Coalescing Analysis (Warp 0):</text>
      <text x="0" y="18" class="code">T0,T1 load same row (k=0:3 then k=4:7) = consecutive</text>
      <text x="0" y="32" class="code">T2,T3 load next row = stride K apart in global memory</text>
      <text x="0" y="46" class="code">16 rows in warp, 2 float4 per row = 16 transactions</text>
      <rect x="0" y="58" width="420" height="26" fill="#FCF3CF" stroke="#F1C40F" rx="4"/>
      <text x="210" y="76" text-anchor="middle" class="small" fill="#7D6608" font-weight="bold">A loads: 16B per thread, strided by K (same pattern as before, but wider)</text>
    </g>
  </g>

  <!-- RIGHT: B tile vectorized loading -->
  <g transform="translate(560, 480)">
    <text x="400" y="0" text-anchor="middle" class="subtitle" fill="#27AE60">Loading B Tile: float4 along N dimension (PERFECTLY COALESCED)</text>
    <text x="400" y="18" text-anchor="middle" class="small">8x128=1024 floats = 256 float4s, 1 float4 per thread</text>
    <text x="400" y="32" text-anchor="middle" class="small">b_row = vec_idx / 32, b_vec_col = vec_idx % 32</text>

    <!-- B tile grid: warp 0 = 32 threads, all in row 0, loading 32 float4s -->
    <g transform="translate(30, 50)">
      <text x="0" y="-5" class="tiny">col 0:3</text>
      <text x="700" y="-5" text-anchor="end" class="tiny">col 124:127</text>

      <!-- All 32 threads in row 0, each loads a float4 -->
      <rect x="0" y="0" width="22" height="30" fill="#8E44AD" opacity="0.6" stroke="#2C3E50" stroke-width="0.8" rx="1"/>
      <rect x="22" y="0" width="22" height="30" fill="#8E44AD" opacity="0.6" stroke="#2C3E50" stroke-width="0.8" rx="1"/>
      <rect x="44" y="0" width="22" height="30" fill="#8E44AD" opacity="0.6" stroke="#2C3E50" stroke-width="0.8" rx="1"/>
      <rect x="66" y="0" width="22" height="30" fill="#8E44AD" opacity="0.6" stroke="#2C3E50" stroke-width="0.8" rx="1"/>
      <rect x="88" y="0" width="22" height="30" fill="#8E44AD" opacity="0.6" stroke="#2C3E50" stroke-width="0.8" rx="1"/>
      <rect x="110" y="0" width="22" height="30" fill="#8E44AD" opacity="0.6" stroke="#2C3E50" stroke-width="0.8" rx="1"/>
      <rect x="132" y="0" width="22" height="30" fill="#8E44AD" opacity="0.6" stroke="#2C3E50" stroke-width="0.8" rx="1"/>
      <rect x="154" y="0" width="22" height="30" fill="#8E44AD" opacity="0.6" stroke="#2C3E50" stroke-width="0.8" rx="1"/>
      <rect x="176" y="0" width="22" height="30" fill="#8E44AD" opacity="0.6" stroke="#2C3E50" stroke-width="0.8" rx="1"/>
      <rect x="198" y="0" width="22" height="30" fill="#8E44AD" opacity="0.6" stroke="#2C3E50" stroke-width="0.8" rx="1"/>
      <rect x="220" y="0" width="22" height="30" fill="#8E44AD" opacity="0.6" stroke="#2C3E50" stroke-width="0.8" rx="1"/>
      <rect x="242" y="0" width="22" height="30" fill="#8E44AD" opacity="0.6" stroke="#2C3E50" stroke-width="0.8" rx="1"/>
      <rect x="264" y="0" width="22" height="30" fill="#8E44AD" opacity="0.6" stroke="#2C3E50" stroke-width="0.8" rx="1"/>
      <rect x="286" y="0" width="22" height="30" fill="#8E44AD" opacity="0.6" stroke="#2C3E50" stroke-width="0.8" rx="1"/>
      <rect x="308" y="0" width="22" height="30" fill="#8E44AD" opacity="0.6" stroke="#2C3E50" stroke-width="0.8" rx="1"/>
      <rect x="330" y="0" width="22" height="30" fill="#8E44AD" opacity="0.6" stroke="#2C3E50" stroke-width="0.8" rx="1"/>
      <rect x="352" y="0" width="22" height="30" fill="#8E44AD" opacity="0.6" stroke="#2C3E50" stroke-width="0.8" rx="1"/>
      <rect x="374" y="0" width="22" height="30" fill="#8E44AD" opacity="0.6" stroke="#2C3E50" stroke-width="0.8" rx="1"/>
      <rect x="396" y="0" width="22" height="30" fill="#8E44AD" opacity="0.6" stroke="#2C3E50" stroke-width="0.8" rx="1"/>
      <rect x="418" y="0" width="22" height="30" fill="#8E44AD" opacity="0.6" stroke="#2C3E50" stroke-width="0.8" rx="1"/>
      <rect x="440" y="0" width="22" height="30" fill="#8E44AD" opacity="0.6" stroke="#2C3E50" stroke-width="0.8" rx="1"/>
      <rect x="462" y="0" width="22" height="30" fill="#8E44AD" opacity="0.6" stroke="#2C3E50" stroke-width="0.8" rx="1"/>
      <rect x="484" y="0" width="22" height="30" fill="#8E44AD" opacity="0.6" stroke="#2C3E50" stroke-width="0.8" rx="1"/>
      <rect x="506" y="0" width="22" height="30" fill="#8E44AD" opacity="0.6" stroke="#2C3E50" stroke-width="0.8" rx="1"/>
      <rect x="528" y="0" width="22" height="30" fill="#8E44AD" opacity="0.6" stroke="#2C3E50" stroke-width="0.8" rx="1"/>
      <rect x="550" y="0" width="22" height="30" fill="#8E44AD" opacity="0.6" stroke="#2C3E50" stroke-width="0.8" rx="1"/>
      <rect x="572" y="0" width="22" height="30" fill="#8E44AD" opacity="0.6" stroke="#2C3E50" stroke-width="0.8" rx="1"/>
      <rect x="594" y="0" width="22" height="30" fill="#8E44AD" opacity="0.6" stroke="#2C3E50" stroke-width="0.8" rx="1"/>
      <rect x="616" y="0" width="22" height="30" fill="#8E44AD" opacity="0.6" stroke="#2C3E50" stroke-width="0.8" rx="1"/>
      <rect x="638" y="0" width="22" height="30" fill="#8E44AD" opacity="0.6" stroke="#2C3E50" stroke-width="0.8" rx="1"/>
      <rect x="660" y="0" width="22" height="30" fill="#8E44AD" opacity="0.6" stroke="#2C3E50" stroke-width="0.8" rx="1"/>
      <rect x="682" y="0" width="22" height="30" fill="#8E44AD" opacity="0.6" stroke="#2C3E50" stroke-width="0.8" rx="1"/>

      <text x="4" y="20" class="tiny" fill="white" font-weight="bold">T0</text>
      <text x="26" y="20" class="tiny" fill="white" font-weight="bold">T1</text>
      <text x="48" y="20" class="tiny" fill="white" font-weight="bold">T2</text>
      <text x="312" y="20" class="tiny" fill="white" font-weight="bold">...</text>
      <text x="660" y="20" class="tiny" fill="white" font-weight="bold">T30</text>
      <text x="682" y="20" class="tiny" fill="white" font-weight="bold">T31</text>

      <text x="-10" y="20" text-anchor="end" class="small">row 0</text>
      <text x="350" y="48" text-anchor="middle" class="tiny" fill="#666">Each box = one float4 (16B). 32 float4s = 512B = entire row 0 of B tile</text>
    </g>

    <!-- Coalescing analysis for B -->
    <g transform="translate(30, 115)">
      <text x="0" y="0" class="subtitle">Coalescing Analysis (Warp 0):</text>
      <text x="0" y="18" class="code">All 32 threads load consecutive float4s in B row 0</text>
      <text x="0" y="32" class="code">32 x float4 = 32 x 16B = 512B contiguous in global memory</text>
      <rect x="0" y="46" width="500" height="26" fill="#D5F5E3" stroke="#27AE60" rx="4"/>
      <text x="250" y="64" text-anchor="middle" class="small" fill="#1E8449" font-weight="bold">4 coalesced 128B transactions per warp (512B total) -- perfectly coalesced!</text>
    </g>

    <!-- Scalar vs float4 comparison -->
    <g transform="translate(30, 180)">
      <text x="0" y="0" class="subtitle">Comparison: Scalar (tiled_reg) vs float4 (this kernel):</text>
      <!-- Scalar -->
      <rect x="0" y="15" width="330" height="60" fill="#FADBD8" stroke="#C0392B" stroke-width="1" rx="4"/>
      <text x="165" y="33" text-anchor="middle" class="small bold" fill="#C0392B">tiled_reg: Scalar float loads (4B each)</text>
      <text x="10" y="48" class="code" fill="#C0392B">1024 floats / 256 threads = 4 loads/thread</text>
      <text x="10" y="62" class="code" fill="#C0392B">4 iterations x 1 scalar load = 4 x 32-bit</text>

      <!-- float4 -->
      <rect x="350" y="15" width="330" height="60" fill="#D5F5E3" stroke="#27AE60" stroke-width="1" rx="4"/>
      <text x="515" y="33" text-anchor="middle" class="small bold" fill="#1E8449">tiled_vec: float4 loads (16B each)</text>
      <text x="360" y="48" class="code" fill="#1E8449">1024 floats / 256 threads = 1 float4/thread</text>
      <text x="360" y="62" class="code" fill="#1E8449">1 iteration x 1 float4 load = 1 x 128-bit</text>
    </g>
  </g>

  <!-- ============================================================ -->
  <!-- SECTION 3: Padded Shared Memory (KEY DIFFERENCE)             -->
  <!-- ============================================================ -->
  <line x1="40" y1="800" x2="1460" y2="800" stroke="#DDD" stroke-width="1"/>
  <text x="50" y="830" class="section-title">3. Padded Shared Memory Layout: Eliminating Bank Conflicts</text>
  <text x="50" y="848" class="small" fill="#C0392B">KEY DIFFERENCE: As[128][8+4]=As[128][12], Bs[8][128+4]=Bs[8][132]. PAD=4 breaks bank conflict patterns.</text>

  <!-- As bank analysis -->
  <g transform="translate(60, 870)">
    <text x="280" y="0" text-anchor="middle" class="subtitle" fill="#4A90D9">As[BLK_M][BLK_K+PAD] = As[128][12], stride = 12 floats</text>

    <g transform="translate(20, 20)">
      <text x="0" y="0" class="code bold">Bank analysis: bank(m,k) = (m*12 + k) % 32</text>
      <text x="0" y="18" class="code" fill="#1E8449">m=0: banks 0, 1, 2, 3, 4, 5, 6, 7</text>
      <text x="0" y="32" class="code" fill="#1E8449">m=1: banks 12, 13, 14, 15, 16, 17, 18, 19  (shifted by 12!)</text>
      <text x="0" y="46" class="code" fill="#1E8449">m=2: banks 24, 25, 26, 27, 28, 29, 30, 31  (shifted by 24)</text>
      <text x="0" y="60" class="code" fill="#1E8449">m=3: banks 4, 5, 6, 7, 8, 9, 10, 11        (shifted by 36%32=4)</text>
      <text x="0" y="80" class="code" fill="#888">GCD(12,32) = 4, so conflict-free for TM=8 consecutive rows at same k</text>

      <!-- Compare: Without PAD -->
      <g transform="translate(0, 100)">
        <rect x="0" y="0" width="560" height="55" fill="#FADBD8" stroke="#C0392B" rx="4"/>
        <text x="280" y="18" text-anchor="middle" class="small bold" fill="#C0392B">WITHOUT padding (stride = 8): bank(m,k) = (m*8+k)%32</text>
        <text x="10" y="36" class="code" fill="#C0392B">m=0,4,8,12 all map to same banks at same k = bank conflict!</text>
        <text x="10" y="48" class="code" fill="#C0392B">Every 4th row collides: 4-way bank conflict during As reads</text>
      </g>
    </g>
  </g>

  <!-- Bs bank analysis -->
  <g transform="translate(700, 870)">
    <text x="330" y="0" text-anchor="middle" class="subtitle" fill="#27AE60">Bs[BLK_K][BLK_N+PAD] = Bs[8][132], stride = 132 floats</text>

    <g transform="translate(20, 20)">
      <text x="0" y="0" class="code bold">Bank analysis: bank(k,n) = (k*132 + n) % 32</text>
      <text x="0" y="18" class="code">Since 132 % 32 = 4:</text>
      <text x="0" y="34" class="code" fill="#1E8449">k=0: bank(n) = n % 32</text>
      <text x="0" y="48" class="code" fill="#1E8449">k=1: bank(n) = (4 + n) % 32   (shifted by 4)</text>
      <text x="0" y="62" class="code" fill="#1E8449">k=2: bank(n) = (8 + n) % 32   (shifted by 8)</text>
      <text x="0" y="76" class="code" fill="#1E8449">Different k values shift by 4 banks each</text>

      <!-- Compare: Without PAD -->
      <g transform="translate(0, 100)">
        <rect x="0" y="0" width="560" height="55" fill="#FADBD8" stroke="#C0392B" rx="4"/>
        <text x="280" y="18" text-anchor="middle" class="small bold" fill="#C0392B">WITHOUT padding (stride = 128): bank(k,n) = (k*128+n)%32 = n%32</text>
        <text x="10" y="36" class="code" fill="#C0392B">All k values map to same bank for same n = 4-way bank conflict!</text>
        <text x="10" y="48" class="code" fill="#C0392B">Threads reading Bs[k][col], Bs[k][col+8], etc. collide at stride-8</text>
      </g>
    </g>
  </g>

  <!-- Bank diagram: with padding -->
  <g transform="translate(60, 1060)">
    <text x="0" y="0" class="subtitle">Bank Collision Map (Bs, thread_col=0, j=0): With PAD=4</text>
    <g transform="translate(0, 14)">
      <!-- 32 bank cells - all green (no conflicts) -->
      <rect x="0" y="0" width="18" height="22" fill="#27AE60" opacity="0.5" stroke="#333" stroke-width="0.5" rx="1"/>
      <rect x="18" y="0" width="18" height="22" fill="#ECF0F1" stroke="#333" stroke-width="0.5" rx="1"/>
      <rect x="36" y="0" width="18" height="22" fill="#ECF0F1" stroke="#333" stroke-width="0.5" rx="1"/>
      <rect x="54" y="0" width="18" height="22" fill="#ECF0F1" stroke="#333" stroke-width="0.5" rx="1"/>
      <rect x="72" y="0" width="18" height="22" fill="#27AE60" opacity="0.5" stroke="#333" stroke-width="0.5" rx="1"/>
      <rect x="90" y="0" width="18" height="22" fill="#ECF0F1" stroke="#333" stroke-width="0.5" rx="1"/>
      <rect x="108" y="0" width="18" height="22" fill="#ECF0F1" stroke="#333" stroke-width="0.5" rx="1"/>
      <rect x="126" y="0" width="18" height="22" fill="#ECF0F1" stroke="#333" stroke-width="0.5" rx="1"/>
      <rect x="144" y="0" width="18" height="22" fill="#27AE60" opacity="0.5" stroke="#333" stroke-width="0.5" rx="1"/>
      <rect x="162" y="0" width="18" height="22" fill="#ECF0F1" stroke="#333" stroke-width="0.5" rx="1"/>
      <rect x="180" y="0" width="18" height="22" fill="#ECF0F1" stroke="#333" stroke-width="0.5" rx="1"/>
      <rect x="198" y="0" width="18" height="22" fill="#ECF0F1" stroke="#333" stroke-width="0.5" rx="1"/>
      <rect x="216" y="0" width="18" height="22" fill="#27AE60" opacity="0.5" stroke="#333" stroke-width="0.5" rx="1"/>
      <rect x="234" y="0" width="18" height="22" fill="#ECF0F1" stroke="#333" stroke-width="0.5" rx="1"/>
      <rect x="252" y="0" width="18" height="22" fill="#ECF0F1" stroke="#333" stroke-width="0.5" rx="1"/>
      <rect x="270" y="0" width="18" height="22" fill="#ECF0F1" stroke="#333" stroke-width="0.5" rx="1"/>
      <rect x="288" y="0" width="18" height="22" fill="#27AE60" opacity="0.5" stroke="#333" stroke-width="0.5" rx="1"/>
      <rect x="306" y="0" width="18" height="22" fill="#ECF0F1" stroke="#333" stroke-width="0.5" rx="1"/>
      <rect x="324" y="0" width="18" height="22" fill="#ECF0F1" stroke="#333" stroke-width="0.5" rx="1"/>
      <rect x="342" y="0" width="18" height="22" fill="#ECF0F1" stroke="#333" stroke-width="0.5" rx="1"/>
      <rect x="360" y="0" width="18" height="22" fill="#27AE60" opacity="0.5" stroke="#333" stroke-width="0.5" rx="1"/>
      <rect x="378" y="0" width="18" height="22" fill="#ECF0F1" stroke="#333" stroke-width="0.5" rx="1"/>
      <rect x="396" y="0" width="18" height="22" fill="#ECF0F1" stroke="#333" stroke-width="0.5" rx="1"/>
      <rect x="414" y="0" width="18" height="22" fill="#ECF0F1" stroke="#333" stroke-width="0.5" rx="1"/>
      <rect x="432" y="0" width="18" height="22" fill="#27AE60" opacity="0.5" stroke="#333" stroke-width="0.5" rx="1"/>
      <rect x="450" y="0" width="18" height="22" fill="#ECF0F1" stroke="#333" stroke-width="0.5" rx="1"/>
      <rect x="468" y="0" width="18" height="22" fill="#ECF0F1" stroke="#333" stroke-width="0.5" rx="1"/>
      <rect x="486" y="0" width="18" height="22" fill="#ECF0F1" stroke="#333" stroke-width="0.5" rx="1"/>
      <rect x="504" y="0" width="18" height="22" fill="#27AE60" opacity="0.5" stroke="#333" stroke-width="0.5" rx="1"/>
      <rect x="522" y="0" width="18" height="22" fill="#ECF0F1" stroke="#333" stroke-width="0.5" rx="1"/>
      <rect x="540" y="0" width="18" height="22" fill="#ECF0F1" stroke="#333" stroke-width="0.5" rx="1"/>
      <rect x="558" y="0" width="18" height="22" fill="#ECF0F1" stroke="#333" stroke-width="0.5" rx="1"/>

      <!-- Bank labels on the highlighted ones -->
      <text x="5" y="16" class="tiny" fill="white" font-weight="bold">0</text>
      <text x="77" y="16" class="tiny" fill="white" font-weight="bold">4</text>
      <text x="149" y="16" class="tiny" fill="white" font-weight="bold">8</text>
      <text x="219" y="16" class="tiny" fill="white" font-weight="bold">12</text>
      <text x="291" y="16" class="tiny" fill="white" font-weight="bold">16</text>
      <text x="363" y="16" class="tiny" fill="white" font-weight="bold">20</text>
      <text x="435" y="16" class="tiny" fill="white" font-weight="bold">24</text>
      <text x="507" y="16" class="tiny" fill="white" font-weight="bold">28</text>

      <!-- Thread annotations: each hits unique bank -->
      <text x="9" y="40" text-anchor="middle" class="tiny" fill="#1E8449">k=0</text>
      <text x="81" y="40" text-anchor="middle" class="tiny" fill="#1E8449">k=1</text>
      <text x="153" y="40" text-anchor="middle" class="tiny" fill="#1E8449">k=2</text>
      <text x="225" y="40" text-anchor="middle" class="tiny" fill="#1E8449">k=3</text>
      <text x="297" y="40" text-anchor="middle" class="tiny" fill="#1E8449">k=4</text>
      <text x="369" y="40" text-anchor="middle" class="tiny" fill="#1E8449">k=5</text>
      <text x="441" y="40" text-anchor="middle" class="tiny" fill="#1E8449">k=6</text>
      <text x="513" y="40" text-anchor="middle" class="tiny" fill="#1E8449">k=7</text>
    </g>
    <text x="288" y="70" text-anchor="middle" class="tiny">Banks 0-31 (each k-step accesses a different bank for Bs[k][0] with PAD=4)</text>
    <rect x="0" y="80" width="580" height="26" fill="#D5F5E3" stroke="#27AE60" rx="4"/>
    <text x="290" y="98" text-anchor="middle" class="small" fill="#1E8449" font-weight="bold">Zero bank conflicts! PAD shifts each k-row by 4 banks (stride 132 % 32 = 4)</text>
  </g>

  <!-- Cost annotation -->
  <g transform="translate(700, 1070)">
    <rect x="0" y="0" width="400" height="60" fill="white" stroke="#DDD" stroke-width="1" rx="6"/>
    <text x="200" y="20" text-anchor="middle" class="subtitle">Padding Cost</text>
    <text x="10" y="38" class="code">Extra smem: As: 128*4=512 floats, Bs: 8*4=32 floats</text>
    <text x="10" y="52" class="code">= 2.2KB extra (~3-6% overhead) for zero bank conflicts</text>
  </g>

  <!-- ============================================================ -->
  <!-- SECTION 4: Compute Pattern (same outer product)              -->
  <!-- ============================================================ -->
  <line x1="40" y1="1180" x2="1460" y2="1180" stroke="#DDD" stroke-width="1"/>
  <text x="50" y="1210" class="section-title">4. Compute Pattern: Outer Product (identical to tiled_reg, but conflict-free smem reads)</text>

  <g transform="translate(80, 1240)">
    <!-- a_reg column vector -->
    <text x="25" y="-10" text-anchor="middle" class="subtitle" fill="#4A90D9">a_reg[8]</text>
    <text x="25" y="5" text-anchor="middle" class="tiny" fill="#666">from As col k</text>
    <rect x="0" y="15" width="50" height="28" fill="#A8D0F5" stroke="#4A90D9" stroke-width="1.5" rx="2"/>
    <text x="25" y="34" text-anchor="middle" class="small">a[0]</text>
    <rect x="0" y="43" width="50" height="28" fill="#A8D0F5" stroke="#4A90D9" stroke-width="1.5" rx="2"/>
    <text x="25" y="62" text-anchor="middle" class="small">a[1]</text>
    <rect x="0" y="71" width="50" height="28" fill="#A8D0F5" stroke="#4A90D9" stroke-width="1.5" rx="2"/>
    <text x="25" y="90" text-anchor="middle" class="small">a[2]</text>
    <rect x="0" y="99" width="50" height="12" fill="#A8D0F5" stroke="#4A90D9" stroke-width="0.8" rx="2"/>
    <text x="25" y="108" text-anchor="middle" class="tiny">...</text>
    <rect x="0" y="111" width="50" height="28" fill="#A8D0F5" stroke="#4A90D9" stroke-width="1.5" rx="2"/>
    <text x="25" y="130" text-anchor="middle" class="small">a[7]</text>

    <!-- b_reg row vector -->
    <g transform="translate(70, -30)">
      <text x="140" y="-5" text-anchor="middle" class="subtitle" fill="#27AE60">b_reg[8] from Bs row k</text>
      <rect x="0" y="5" width="36" height="28" fill="#B8E6CC" stroke="#27AE60" stroke-width="1.5" rx="2"/>
      <text x="18" y="24" text-anchor="middle" class="small">b[0]</text>
      <rect x="36" y="5" width="36" height="28" fill="#B8E6CC" stroke="#27AE60" stroke-width="1.5" rx="2"/>
      <text x="54" y="24" text-anchor="middle" class="small">b[1]</text>
      <rect x="72" y="5" width="36" height="28" fill="#B8E6CC" stroke="#27AE60" stroke-width="1.5" rx="2"/>
      <text x="90" y="24" text-anchor="middle" class="small">b[2]</text>
      <rect x="108" y="5" width="36" height="28" fill="#B8E6CC" stroke="#27AE60" stroke-width="1.5" rx="2"/>
      <text x="126" y="24" text-anchor="middle" class="tiny">...</text>
      <rect x="144" y="5" width="36" height="28" fill="#B8E6CC" stroke="#27AE60" stroke-width="1.5" rx="2"/>
      <text x="162" y="24" text-anchor="middle" class="small">b[6]</text>
      <rect x="180" y="5" width="36" height="28" fill="#B8E6CC" stroke="#27AE60" stroke-width="1.5" rx="2"/>
      <text x="198" y="24" text-anchor="middle" class="small">b[7]</text>
    </g>

    <!-- Accumulator 8x8 mini grid -->
    <g transform="translate(70, 15)">
      <text x="108" y="-38" text-anchor="middle" class="subtitle" fill="#E67E22">accum[8][8] += a[i] * b[j]</text>
      <!-- Simplified 8x8 grid with just outlines -->
      <rect x="0" y="0" width="216" height="126" fill="url(#fma-grad)" opacity="0.2" stroke="#E67E22" stroke-width="1.5" rx="3"/>
      <!-- Grid lines -->
      <line x1="27" y1="0" x2="27" y2="126" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="54" y1="0" x2="54" y2="126" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="81" y1="0" x2="81" y2="126" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="108" y1="0" x2="108" y2="126" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="135" y1="0" x2="135" y2="126" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="162" y1="0" x2="162" y2="126" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="189" y1="0" x2="189" y2="126" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="0" y1="18" x2="216" y2="18" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="0" y1="36" x2="216" y2="36" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="0" y1="54" x2="216" y2="54" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="0" y1="72" x2="216" y2="72" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="0" y1="90" x2="216" y2="90" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <line x1="0" y1="108" x2="216" y2="108" stroke="#E67E22" stroke-width="0.3" opacity="0.5"/>
      <text x="108" y="68" text-anchor="middle" class="small bold" fill="#E67E22">64 FMAs per k-step</text>
    </g>

    <!-- Stats box -->
    <g transform="translate(340, 0)">
      <rect x="0" y="0" width="340" height="130" fill="white" stroke="#DDD" stroke-width="1" rx="6"/>
      <text x="170" y="22" text-anchor="middle" class="subtitle">Per Thread, Per k-step</text>
      <line x1="10" y1="30" x2="330" y2="30" stroke="#EEE"/>
      <text x="15" y="50" class="code" fill="#4A90D9">Smem loads from As:  TM  =  8 (broadcast, no conflicts)</text>
      <text x="15" y="68" class="code" fill="#27AE60">Smem loads from Bs:  TN  =  8 (conflict-free with PAD!)</text>
      <line x1="15" y1="76" x2="280" y2="76" stroke="#EEE"/>
      <text x="15" y="94" class="code">Total smem loads:    TM+TN = 16</text>
      <text x="15" y="114" class="code" fill="#E67E22">FMA operations:      TM*TN = 64  (ratio 4:1)</text>
    </g>

    <!-- Key improvement callout -->
    <g transform="translate(700, 0)">
      <rect x="0" y="0" width="360" height="130" fill="#D5F5E3" stroke="#27AE60" stroke-width="1.5" rx="6"/>
      <text x="180" y="22" text-anchor="middle" class="subtitle" fill="#1E8449">Improvement Over tiled_reg</text>
      <line x1="10" y1="30" x2="350" y2="30" stroke="#27AE60" opacity="0.3"/>
      <text x="15" y="50" class="code" fill="#1E8449">As reads: broadcast (same as before)</text>
      <text x="15" y="68" class="code" fill="#1E8449">Bs reads: ZERO bank conflicts (was 4-way!)</text>
      <text x="15" y="88" class="code" fill="#1E8449">Each smem read completes in 1 cycle</text>
      <text x="15" y="108" class="code" fill="#1E8449">vs 4 serialized cycles with bank conflicts</text>
    </g>
  </g>

  <!-- ============================================================ -->
  <!-- SECTION 5: Comparison Summary                                -->
  <!-- ============================================================ -->
  <line x1="40" y1="1420" x2="1460" y2="1420" stroke="#DDD" stroke-width="1"/>
  <text x="50" y="1450" class="section-title">5. Overall Data Flow &amp; Comparison vs tiled_reg</text>

  <g transform="translate(60, 1475)">
    <!-- Pipeline stages -->
    <!-- Stage 1: Global -> Shared -->
    <rect x="0" y="0" width="300" height="110" fill="#EBF5FB" stroke="#4A90D9" stroke-width="2" rx="8"/>
    <text x="150" y="22" text-anchor="middle" class="subtitle" fill="#4A90D9">Global --> Shared Memory</text>
    <text x="10" y="42" class="code bold" fill="#1E8449">float4 vectorized loads (128-bit)</text>
    <text x="10" y="58" class="code">A: 128x8 = 256 float4s (1 per thread)</text>
    <text x="10" y="74" class="code">B: 8x128 = 256 float4s (1 per thread)</text>
    <text x="10" y="92" class="code" fill="#1E8449">4x fewer memory transactions vs scalar</text>

    <!-- Arrow -->
    <path d="M310,55 L360,55" class="arrow-bold"/>

    <!-- Stage 2: Shared -> Registers -->
    <rect x="370" y="0" width="300" height="110" fill="#FDEBD0" stroke="#E67E22" stroke-width="2" rx="8"/>
    <text x="520" y="22" text-anchor="middle" class="subtitle" fill="#E67E22">Shared --> Registers</text>
    <text x="380" y="42" class="code">Per k-step (k = 0..7):</text>
    <text x="380" y="58" class="code">a_reg[8] from As (broadcast)</text>
    <text x="380" y="74" class="code">b_reg[8] from Bs (conflict-free!)</text>
    <text x="380" y="92" class="code bold" fill="#1E8449">PAD=4 eliminates bank conflicts</text>

    <!-- Arrow -->
    <path d="M680,55 L730,55" class="arrow-bold"/>

    <!-- Stage 3: Compute -->
    <rect x="740" y="0" width="280" height="110" fill="#FADBD8" stroke="#E74C3C" stroke-width="2" rx="8"/>
    <text x="880" y="22" text-anchor="middle" class="subtitle" fill="#E74C3C">Register Compute (FMA)</text>
    <text x="750" y="42" class="code">accum[i][j] += a[i] * b[j]</text>
    <text x="750" y="58" class="code">8x8 = 64 FMAs per k-step</text>
    <text x="750" y="74" class="code">x 8 k-steps = 512 FMAs/tile</text>
    <text x="750" y="92" class="code">Identical to tiled_reg</text>

    <!-- Loop arrow -->
    <path d="M150,110 L150,135 L880,135 L880,110" fill="none" stroke="#888" stroke-width="1.5" stroke-dasharray="6,3"/>
    <text x="500" y="150" text-anchor="middle" class="small" fill="#888">repeat for each BLK_K tile along K dimension (K/8 iterations)</text>
  </g>

  <!-- Comparison table -->
  <g transform="translate(60, 1660)">
    <rect x="0" y="0" width="1100" height="180" fill="white" stroke="#333" stroke-width="1.5" rx="6"/>
    <text x="550" y="24" text-anchor="middle" class="subtitle">Comparison Summary: tiled_reg vs tiled_vec</text>
    <line x1="10" y1="32" x2="1090" y2="32" stroke="#DDD"/>

    <!-- Header row -->
    <text x="30" y="50" class="small bold">Aspect</text>
    <text x="280" y="50" class="small bold" fill="#C0392B">tiled_reg (03)</text>
    <text x="600" y="50" class="small bold" fill="#1E8449">tiled_vec (04)</text>
    <text x="900" y="50" class="small bold">Improvement</text>
    <line x1="10" y1="58" x2="1090" y2="58" stroke="#DDD"/>

    <!-- Global loads -->
    <text x="30" y="76" class="code">Global loads</text>
    <text x="280" y="76" class="code" fill="#C0392B">Scalar float (4B), 4 iters/thread</text>
    <text x="600" y="76" class="code" fill="#1E8449">float4 (16B), 1 iter/thread</text>
    <text x="900" y="76" class="code bold">4x fewer transactions</text>

    <!-- Shared memory -->
    <text x="30" y="98" class="code">Shared memory</text>
    <text x="280" y="98" class="code" fill="#C0392B">As[128][8], Bs[8][128] (no padding)</text>
    <text x="600" y="98" class="code" fill="#1E8449">As[128][12], Bs[8][132] (PAD=4)</text>
    <text x="900" y="98" class="code bold">Zero bank conflicts</text>

    <!-- Smem reads -->
    <text x="30" y="120" class="code">Smem reads</text>
    <text x="280" y="120" class="code" fill="#C0392B">Bs: 4-way bank conflict (stride-8)</text>
    <text x="600" y="120" class="code" fill="#1E8449">Bs: conflict-free (stride shifted)</text>
    <text x="900" y="120" class="code bold">~4x smem throughput</text>

    <!-- Compute -->
    <text x="30" y="142" class="code">Compute</text>
    <text x="280" y="142" class="code">64 FMAs/k-step, 512 FMAs/tile</text>
    <text x="600" y="142" class="code">64 FMAs/k-step, 512 FMAs/tile</text>
    <text x="900" y="142" class="code">Identical</text>

    <!-- Overall -->
    <line x1="10" y1="152" x2="1090" y2="152" stroke="#DDD"/>
    <text x="30" y="170" class="code bold">Expected speedup</text>
    <text x="600" y="170" class="code bold" fill="#1E8449">Typically 1.5-2x from vectorization + bank conflict elimination</text>
  </g>

  <!-- Footer -->
  <text x="750" y="2075" text-anchor="middle" class="tiny" fill="#AAA">matmul_tiled_vec&lt;128, 128, 8, 8, 8&gt; -- Memory Access Pattern Diagram</text>
</svg>
